{% extends "base.html" %}
{% block title %}{{ survey.title }}{% endblock %}
{% block header %}{{ survey.title }}{% endblock %}
{% block content %}
<div class="flex gap-4 mb-6">
  <a href="{{ url_for('surveys.respond', sid=survey.id) }}" class="px-4 py-2 bg-[#1E3A8A] text-white rounded-lg hover:bg-[#1e40af]">Respond to Survey</a>
  <a href="{{ url_for('surveys.import_responses', sid=survey.id) }}" class="px-4 py-2 border rounded-lg hover:bg-slate-50">Import Responses</a>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="bg-white rounded-xl border border-slate-200 p-6">
    <h3 class="font-semibold text-slate-800 mb-4">Question Averages</h3>
    <div class="space-y-3">
      {% for q in survey.questions %}
      <div class="flex justify-between items-center py-2 border-b border-slate-100">
        <span class="text-slate-700">{{ q.question_text[:50] }}{% if q.question_text|length > 50 %}...{% endif %}</span>
        <span class="font-semibold">{{ avg_map.get(q.id, {}).get('avg', 0) }} (n={{ avg_map.get(q.id, {}).get('count', 0) }})</span>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="bg-white rounded-xl border border-slate-200 p-6">
    <h3 class="font-semibold text-slate-800 mb-4">Chart</h3>
    <canvas id="survey-chart" height="200"></canvas>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
fetch('/surveys/api/{{ survey.id }}/chart-data').then(r=>r.json()).then(d=>{
  if (d.labels && d.labels.length) {
    new Chart(document.getElementById('survey-chart'), {
      type: 'bar',
      data: { labels: d.labels, datasets: [{ label: 'Average', data: d.data, backgroundColor: '#0d9488' }] }
    });
  }
}).catch(()=>{});
</script>
{% endblock %}
